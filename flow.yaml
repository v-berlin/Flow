# ============================================
# FLOW PRODUCTIVITY TRACKER - REFERENCE
# ============================================
# This file is for REFERENCE ONLY when using Home Assistant Core with YAML support
# For Docker users: Create these entities through the Web UI (Settings > Devices & Services > Helpers)

# ESSENTIAL INPUT NUMBERS (Create via Web UI: Helpers > Number)
input_number:
  flow_daily_goal:
    name: "Flow: Daily Goal"
    min: 0
    max: 1440
    step: 5
    unit_of_measurement: "min"
    icon: mdi:target

  flow_time_tracked_today:
    name: "Flow: Time Tracked Today"
    min: 0
    max: 1440
    step: 1
    unit_of_measurement: "min"
    icon: mdi:clock-check

  flow_streak_counter:
    name: "Flow: Streak Days"
    min: 0
    max: 9999
    step: 1
    icon: mdi:fire

# ESSENTIAL INPUT BOOLEANS (Create via Web UI: Helpers > Toggle)
input_boolean:
  flow_timer_active:
    name: "Flow: Timer Active"
    icon: mdi:play-pause

  flow_sick_mode:
    name: "Flow: Sick Mode"
    icon: mdi:hospital-box

  # Category Toggles
  flow_cat_work:
    name: "Flow: Work"
    icon: mdi:briefcase

  flow_cat_personal:
    name: "Flow: Personal"
    icon: mdi:home

  flow_cat_coding:
    name: "Flow: Coding"
    icon: mdi:code-braces

  flow_cat_design:
    name: "Flow: Design"
    icon: mdi:palette

  flow_cat_other:
    name: "Flow: Other"
    icon: mdi:circle-outline

# INPUT DATETIME (Create via Web UI: Helpers > Date and/or Time)
input_datetime:
  flow_timer_start:
    name: "Flow: Timer Start Time"
    has_date: true
    has_time: true

# INPUT TEXT (Create via Web UI: Helpers > Text)
input_text:
  flow_active_category:
    name: "Flow: Active Category"
    initial: "None"
    max: 20

# TEMPLATE SENSORS (Create via Web UI: Settings > Devices & Services > Helpers > Template Sensor)
template:
  - sensor:
      # Progress Percentage
      - name: "Flow: Goal Progress"
        unique_id: flow_goal_progress
        state: >
          {% set goal = states('input_number.flow_daily_goal') | float(0) %}
          {% set tracked = states('input_number.flow_time_tracked_today') | float(0) %}
          {% if goal > 0 %}
            {{ ((tracked / goal) * 100) | round(1) }}
          {% else %}
            0
          {% endif %}
        unit_of_measurement: "%"
        icon: mdi:percent-circle
        attributes:
          tracked_minutes: "{{ states('input_number.flow_time_tracked_today') | int }}"
          goal_minutes: "{{ states('input_number.flow_daily_goal') | int }}"
          remaining_minutes: >
            {% set diff = states('input_number.flow_daily_goal') | int - states('input_number.flow_time_tracked_today') | int %}
            {{ diff if diff > 0 else 0 }}
          time_formatted: >
            {% set minutes = states('input_number.flow_time_tracked_today') | int %}
            {% set hours = minutes // 60 %}
            {% set mins = minutes % 60 %}
            {{ "%d:%02d" | format(hours, mins) }}

      # Current Status
      - name: "Flow: Status"
        unique_id: flow_status
        state: >
          {% set category = states('input_text.flow_active_category') %}
          {% set progress = states('sensor.flow_goal_progress') | float(0) %}
          {% if states('input_boolean.flow_timer_active') == 'on' %}
            ðŸ”´ {{ category }} running...
          {% elif states('input_boolean.flow_sick_mode') == 'on' %}
            ðŸ¥ Sick Mode
          {% elif progress >= 100 %}
            âœ… Goal Reached!
          {% else %}
            Ready to Start ðŸš€
          {% endif %}
        icon: >
          {% if states('input_boolean.flow_timer_active') == 'on' %}
            mdi:record-circle
          {% else %}
            mdi:information-outline
          {% endif %}

      # Active Work Category
      - name: "Flow: Active Work"
        unique_id: flow_active_work
        state: >
          {% if states('input_boolean.flow_timer_active') == 'on' %}
            {{ states('input_text.flow_active_category') }}
          {% else %}
            Inactive
          {% endif %}
        icon: mdi:briefcase

      # Timer Elapsed Time
      - name: "Flow: Timer Elapsed"
        unique_id: flow_timer_elapsed
        state: >
          {% if states('input_boolean.flow_timer_active') == 'on' %}
            {% set start = states('input_datetime.flow_timer_start') | as_datetime %}
            {% if start %}
              {% set elapsed = (now() - start).total_seconds() / 60 %}
              {{ elapsed | round(0) }}
            {% else %}
              0
            {% endif %}
          {% else %}
            0
          {% endif %}
        unit_of_measurement: "min"
        icon: mdi:timer
